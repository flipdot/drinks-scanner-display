services:
- docker
env:
  global:
  - secure: fUl+W+7q8hhn/D1XP6hRseaA+Kqk9rPcyId4UdpCvIeawAwHZKdjCoRK+0av/Wu3AiY9HSg9N4t1/3K/ugOhHmQgQcbwCR+dDXZsS/f1zw5AEwrg1VhdkHwAPYMcP5dO+zaTT7cBlcH0XPVOp7mr7UZL4hJ0Lhbf2pjtnYIcr8c1Y1HD3XGy/Vd5v91Dh2ugiK7N1wXJf48ApPkcHB+KNR3/yfU2raHvs5JZxxet7NIECrO3+DXHsqnD1SgfxdcA1j8YLjTra4HselNk40C1lVtMOJ0OXt0bTKAEIyB6OqC6bYN9BD/3wgkwnnkvdJPyeriWCBpghC+FI4kSZZOZZhDPWm0Ix7+jH3LusK+rL0pv4rjRGjR97mRDTOTgQ5KpWKhNxTO65t2H28ithBL8evkkxTOGZNW932ZZgYs37dO+m/EuintXg5+llzRai1FmYjxQ9pdjd4DdDxfHOjazpCksxaJIDvGZewyXtJRPbO2GMBcfx6jZBkDeRevzeLQK9UhhrPfalSu6vvUspu2wwRdSJf3HjNOFKBech+P3/54P3VkguSM1t1cILQaJ0buxiNL4KbVMeXhRFOljRgaWlffqzFDAYCz7WVscZd42at7aA6SXo+qrzLB8sVFxamc0v9VyF1ShR1A/n/oG5a2I+wSTg71JOwwHXONutYDs6cE= #DOCKER_USER
  - secure: jebEPm5OLiY5TTPVUzLwskrfWM7Hg6bm+iMS6cydpB3S4SdRUMupmLYcZT2mxpvgKDUvQpGaIGcS3NGyhZKWqJfeefO8tkZxy8Y4tjyet+0ojgp7U9Ive/DRHH9/X2g5u0JJ8+UfF/2acCqhmGyDkAEk8QXJ4qT5Dr6Fp2gd0snlbkLtkKCXh7nXPdTbhxO4H8p+FwdDDjZkMeWZkPNHawROanD42fJJlsd3m0DW++V8Cdg9UklBrPyBlnvwYqLP8mQapT9zzVyimxjKZjHaoQfbZkNfQce5uxqASSFuuKfQp3yUS8JH/jDfmMqudmc7WSq80Zo92pKI26Tuc+SO+AFKrroPq1xc4E/LWfWoxPTQ91jqrom/GYqxs2rtlTJaaOs+PF0luHK0nv4z4Ag5A40KO6BqZHHvG6iN3EcUFcB54LIcCeTHwBgYVEXKYgu3e2cc/lVb2o33SHVDbB3I0i7QnITJ0Iq8bqwLeACC0Rb7XAvcP89a+iTC9v3ZhW86H0m6v5OlQ54pj+zHEX0ajgJWee99SDmEVCJgh4bP9sQ6wBnWNXM7gAtkMnS7u4J6R8uqkxAfNZkMNOJ699nyh8B2XeaBc7kEIS+02zkG7lY5CvXoXbstZVSZNjAgGmTAdsfcIOr0ToNAB+cmRmzqYjx9+IpJjhcJvBp/UbnD/WM= #DOCKER_PASS
  - COMMIT=${TRAVIS_COMMIT::8}
  - REPO_USER=flipdot
  - REPO_NAME=drinks-touch
  - DOCKER_BUILDKIT=1
before_install:
- echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
script:
- travis_wait 60 docker buildx build --cache-from=$REPO_USER/$REPO_NAME:cache --cache-to=$REPO_USER/$REPO_NAME:cache --platform linux/amd64,linux/arm/v7 --push -t $REPO_USER/$REPO_NAME:$COMMIT .
after_success:
- docker tag $REPO_USER/$REPO_NAME:$COMMIT $REPO_USER/$REPO_NAME:$TAG
- docker push $REPO_USER/$REPO_NAME
